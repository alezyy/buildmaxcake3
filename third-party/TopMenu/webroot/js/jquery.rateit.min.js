(function(c){function s(d){var c=d.originalEvent.changedTouches[0],k="",g;switch(d.type){case "touchmove":k="mousemove";break;case "touchend":k="mouseup";break;default:return}g=document.createEvent("MouseEvent");g.initMouseEvent(k,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null);c.target.dispatchEvent(g);d.preventDefault()}c.rateit={aria:{resetLabel:"reset rating",ratingLabel:"rating"}};c.fn.rateit=function(d,h){var k=1,g={},p="init",i;if(0==this.length)return this;if(i=
c.type(d),"object"==i||void 0===d||null==d)g=c.extend({},c.fn.rateit.defaults,d);else{if("string"==i&&void 0===h)return this.data("rateit"+(d.charAt(0).toUpperCase()+d.substr(1)));"string"==i&&(p="setvalue")}return this.each(function(){var e=c(this),a=function(a,b){if(null!=b){var c="aria-value"+("value"==a?"now":a),f=e.find(".rateit-range");void 0!=f.attr(c)&&f.attr(c,b)}return arguments[0]="rateit"+(a.charAt(0).toUpperCase()+a.substr(1)),e.data.apply(e,arguments)},l,b,i,q,f,m,n,j;if(e.hasClass("rateit")||
e.addClass("rateit"),l="rtl"!=e.css("direction"),"setvalue"==p){if(!a("init"))throw"Can't set value before init";"readonly"!=d||!0!=h||a("readonly")||(e.find(".rateit-range").unbind(),a("wired",!1));"value"==d&&(h=null==h?a("min"):Math.max(a("min"),Math.min(a("max"),h)));a("backingfld")&&(b=c(a("backingfld")),"value"==d&&b.val(h),"min"==d&&b[0].min&&(b[0].min=h),"max"==d&&b[0].max&&(b[0].max=h),"step"==d&&b[0].step&&(b[0].step=h));a(d,h)}a("init")||(a("min",a("min")||g.min),a("max",a("max")||g.max),
a("step",a("step")||g.step),a("readonly",void 0!==a("readonly")?a("readonly"):g.readonly),a("resetable",void 0!==a("resetable")?a("resetable"):g.resetable),a("backingfld",a("backingfld")||g.backingfld),a("starwidth",a("starwidth")||g.starwidth),a("starheight",a("starheight")||g.starheight),a("value",Math.max(a("min"),Math.min(a("max"),a("value")||g.value||g.min))),a("ispreset",void 0!==a("ispreset")?a("ispreset"):g.ispreset),a("backingfld")&&(b=c(a("backingfld")),a("value",b.hide().val()),(b.attr("disabled")||
b.attr("readonly"))&&a("readonly",!0),"INPUT"==b[0].nodeName&&("range"==b[0].type||"text"==b[0].type)&&(a("min",parseInt(b.attr("min"))||a("min")),a("max",parseInt(b.attr("max"))||a("max")),a("step",parseInt(b.attr("step"))||a("step"))),"SELECT"==b[0].nodeName&&1<b[0].options.length&&(a("min",Number(b[0].options[0].value)),a("max",Number(b[0].options[b[0].length-1].value)),a("step",Number(b[0].options[1].value)-Number(b[0].options[0].value)))),i="DIV"==e[0].nodeName?"div":"span",k++,q='<button id="rateit-reset-{{index}}" class="rateit-reset" aria-label="'+
c.rateit.aria.resetLabel+'" aria-controls="rateit-range-{{index}}"></button><{{element}} id="rateit-range-{{index}}" class="rateit-range" tabindex="0" role="slider" aria-label="'+c.rateit.aria.ratingLabel+'" aria-owns="rateit-reset-{{index}}" aria-valuemin="'+a("min")+'" aria-valuemax="'+a("max")+'" aria-valuenow="'+a("value")+'"><{{element}} class="rateit-selected" style="height:'+a("starheight")+'px"></{{element}}><{{element}} class="rateit-hover" style="height:'+a("starheight")+'px"></{{element}}></{{element}}>',
e.append(q.replace(/{{index}}/gi,k).replace(/{{element}}/gi,i)),l||(e.find(".rateit-reset").css("float","right"),e.find(".rateit-selected").addClass("rateit-selected-rtl"),e.find(".rateit-hover").addClass("rateit-hover-rtl")),a("init",!0));f=e.find(".rateit-range");f.width(a("starwidth")*(a("max")-a("min"))).height(a("starheight"));m="rateit-preset"+(l?"":"-rtl");a("ispreset")?e.find(".rateit-selected").addClass(m):e.find(".rateit-selected").removeClass(m);null!=a("value")&&(n=(a("value")-a("min"))*
a("starwidth"),e.find(".rateit-selected").width(n));j=e.find(".rateit-reset");!0!==j.data("wired")&&j.bind("click",function(b){b.preventDefault();j.blur();a("value",a("min"));f.find(".rateit-hover").hide().width(0);f.find(".rateit-selected").width(0).show();a("backingfld")&&c(a("backingfld")).val(a("min"));e.trigger("reset")}).data("wired",!0);var r=function(b,e){var d=(e.changedTouches?e.changedTouches[0].pageX:e.pageX)-c(b).offset().left;return l||(d=f.width()-d),d>f.width()&&(d=f.width()),0>d&&
(d=0),n=Math.ceil(d/a("starwidth")*(1/a("step")))},o=function(b){a("value",b);a("backingfld")&&c(a("backingfld")).val(b);a("ispreset")&&(f.find(".rateit-selected").removeClass(m),a("ispreset",!1));f.find(".rateit-hover").hide();f.find(".rateit-selected").width(b*a("starwidth")-a("min")*a("starwidth")).show();e.trigger("hover",[null]).trigger("over",[null]).trigger("rated",[b])};a("readonly")?j.hide():(a("resetable")||j.hide(),a("wired")||(f.bind("touchmove touchend",s),f.mousemove(function(b){var b=
r(this,b),c=b*a("starwidth")*a("step"),d=f.find(".rateit-hover"),g;d.data("width")!=c&&(f.find(".rateit-selected").hide(),d.width(c).show().data("width",c),g=[b*a("step")+a("min")],e.trigger("hover",g).trigger("over",g))}),f.mouseleave(function(){f.find(".rateit-hover").hide().width(0).data("width","");e.trigger("hover",[null]).trigger("over",[null]);f.find(".rateit-selected").show()}),f.mouseup(function(b){b=r(this,b)*a("step")+a("min");o(b)}),f.keyup(function(b){(38==b.which||b.which==(l?39:37))&&
o(Math.min(a("value")+a("step"),a("max")));(40==b.which||b.which==(l?37:39))&&o(Math.max(a("value")-a("step"),a("min")))}),a("wired",!0)),a("resetable")&&j.show());f.attr("aria-readonly",a("readonly"))})};c.fn.rateit.defaults={min:0,max:5,step:0.5,starwidth:16,starheight:16,readonly:!1,resetable:!0,ispreset:!1};c(function(){c("div.rateit, span.rateit").rateit()})})(jQuery);


    // catch stars clicked
    $("#rating").bind('rated', function (event, value) {               
        var linkToCall = $('#rating_link').attr('href') + '/' + value;
        $.get(linkToCall);               
        return false;
    });  